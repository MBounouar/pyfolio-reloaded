
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Round Trip Analysis &#8212; pyfolio 0.9.3+28.g3dcf744 documentation</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Sector Analysis" href="sector_mappings_example.html" />
    <link rel="prev" title="Zipline Algorithm" href="zipline_algo_example.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
      
      <link rel="icon" sizes="16x16" href="../_static/assets/favicon16x16.ico">
      
    
      
      <link rel="icon" sizes="32x32" href="../_static/assets/favicon32x32.ico">
      
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    
<a class="navbar-brand" href="../index.html">
<p class="title">pyfolio</p>
</a>

    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="single_stock_example.html">
  Intro
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="zipline_algo_example.html">
  Zipline Algorithm
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="current reference internal nav-link" href="#">
  Round Trip Analysis
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="sector_mappings_example.html">
  Sector Analysis
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../api-reference.html">
  API
 </a>
</li>

    
    <li class="nav-item">
        <a class="nav-link nav-external" href="https://ml4trading.io">ML for Trading<i class="fas fa-external-link-alt"></i></a>
    </li>
    
    <li class="nav-item">
        <a class="nav-link nav-external" href="https://exchange.ml4trading.io">Community<i class="fas fa-external-link-alt"></i></a>
    </li>
    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/stefan-jansen/pyfolio-reloaded" rel="noopener" target="_blank" title="GitHub">
            <span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/ml4trading" rel="noopener" target="_blank" title="Twitter">
            <span><i class="fab fa-twitter-square"></i></span>
            <label class="sr-only">Twitter</label>
          </a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Imports-&amp;-Settins">
   Imports &amp; Settins
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Load-Data">
   Load Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Add-Sector-Mapping">
   Add Sector Mapping
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Run-Round-Trip-Tear-Sheet">
   Run Round Trip Tear Sheet
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Explore-underlying-functions">
   Explore underlying functions
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                

<div class="tocsection editthispage">
    <a href="https://github.com/stefan-jansen/pyfolio-reloaded/edit/main/docs/source/notebooks/round_trip_tear_sheet_example.ipynb">
        <i class="fas fa-pencil-alt"></i> Edit this page
    </a>
</div>

              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Round-Trip-Analysis">
<h1>Round Trip Analysis<a class="headerlink" href="#Round-Trip-Analysis" title="Permalink to this headline">¶</a></h1>
<p>When evaluating the performance of an investing strategy, it is helpful to quantify the frequency, duration, and profitability of its independent bets, or “round trip” trades. A round trip trade is started when a new long or short position is opened and then later completely or partially closed out.</p>
<p>The intent of the round trip tearsheet is to help differentiate strategies that profited off a few lucky trades from strategies that profited repeatedly from genuine alpha. Breaking down round trip profitability by traded name and sector can also help inform universe selection and identify exposure risks. For example, even if your equity curve looks robust, if only two securities in your universe of fifteen names contributed to overall profitability, you may have reason to question the logic of
your strategy.</p>
<p>To identify round trips, pyfolio reconstructs the complete portfolio based on the transactions that you pass in. When you make a trade, pyfolio checks if shares are already present in your portfolio purchased at a certain price. If there are, we compute the PnL, returns and duration of that round trip trade. In calculating round trips, pyfolio will also append position closing transactions at the last timestamp in the positions data. This closing transaction will cause the PnL from any open
positions to realized as completed round trips.</p>
<div class="section" id="Imports-&amp;-Settins">
<h2>Imports &amp; Settins<a class="headerlink" href="#Imports-&-Settins" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># silence warnings</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pyfolio</span> <span class="k">as</span> <span class="nn">pf</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">gzip</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Load-Data">
<h2>Load Data<a class="headerlink" href="#Load-Data" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">transactions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;../tests/test_data/test_txn.csv.gz&#39;</span><span class="p">),</span>
                    <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">positions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;../tests/test_data/test_pos.csv.gz&#39;</span><span class="p">),</span>
                    <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">returns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;../tests/test_data/test_returns.csv.gz&#39;</span><span class="p">),</span>
                      <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Add-Sector-Mapping">
<h2>Add Sector Mapping<a class="headerlink" href="#Add-Sector-Mapping" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Optional: Sector mappings may be passed in as a dict or pd.Series. If a mapping is</span>
<span class="c1"># provided, PnL from symbols with mappings will be summed to display profitability by sector.</span>
<span class="n">sect_map</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;COST&#39;</span><span class="p">:</span> <span class="s1">&#39;Consumer Goods&#39;</span><span class="p">,</span> <span class="s1">&#39;INTC&#39;</span><span class="p">:</span><span class="s1">&#39;Technology&#39;</span><span class="p">,</span> <span class="s1">&#39;CERN&#39;</span><span class="p">:</span><span class="s1">&#39;Healthcare&#39;</span><span class="p">,</span> <span class="s1">&#39;GPS&#39;</span><span class="p">:</span><span class="s1">&#39;Technology&#39;</span><span class="p">,</span>
            <span class="s1">&#39;MMM&#39;</span><span class="p">:</span> <span class="s1">&#39;Construction&#39;</span><span class="p">,</span> <span class="s1">&#39;DELL&#39;</span><span class="p">:</span> <span class="s1">&#39;Technology&#39;</span><span class="p">,</span> <span class="s1">&#39;AMD&#39;</span><span class="p">:</span><span class="s1">&#39;Technology&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Run-Round-Trip-Tear-Sheet">
<h2>Run Round Trip Tear Sheet<a class="headerlink" href="#Run-Round-Trip-Tear-Sheet" title="Permalink to this headline">¶</a></h2>
<p>The easiest way to run the analysis is to call <code class="docutils literal notranslate"><span class="pre">pyfolio.create_round_trip_tear_sheet()</span></code>. Passing in a sector map is optional. You can also pass <code class="docutils literal notranslate"><span class="pre">round_trips=True</span></code> to <code class="docutils literal notranslate"><span class="pre">pyfolio.create_full_tear_sheet()</span></code> to have this be created along all the other analyses.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pf</span><span class="o">.</span><span class="n">create_round_trip_tear_sheet</span><span class="p">(</span><span class="n">returns</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">transactions</span><span class="p">,</span> <span class="n">sector_mappings</span><span class="o">=</span><span class="n">sect_map</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Summary stats</th>
      <th>All trades</th>
      <th>Short trades</th>
      <th>Long trades</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Total number of round_trips</th>
      <td>5822.00</td>
      <td>1155.00</td>
      <td>4667.00</td>
    </tr>
    <tr>
      <th>Percent profitable</th>
      <td>0.50</td>
      <td>0.52</td>
      <td>0.49</td>
    </tr>
    <tr>
      <th>Winning round_trips</th>
      <td>2886.00</td>
      <td>595.00</td>
      <td>2291.00</td>
    </tr>
    <tr>
      <th>Losing round_trips</th>
      <td>2917.00</td>
      <td>553.00</td>
      <td>2364.00</td>
    </tr>
    <tr>
      <th>Even round_trips</th>
      <td>19.00</td>
      <td>7.00</td>
      <td>12.00</td>
    </tr>
  </tbody>
</table></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>PnL stats</th>
      <th>All trades</th>
      <th>Short trades</th>
      <th>Long trades</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Total profit</th>
      <td>$65404.25</td>
      <td>$3560.10</td>
      <td>$61844.15</td>
    </tr>
    <tr>
      <th>Gross profit</th>
      <td>$448803.34</td>
      <td>$20608.45</td>
      <td>$428194.89</td>
    </tr>
    <tr>
      <th>Gross loss</th>
      <td>$-383399.09</td>
      <td>$-17048.35</td>
      <td>$-366350.75</td>
    </tr>
    <tr>
      <th>Profit factor</th>
      <td>$1.17</td>
      <td>$1.21</td>
      <td>$1.17</td>
    </tr>
    <tr>
      <th>Avg. trade net profit</th>
      <td>$11.23</td>
      <td>$3.08</td>
      <td>$13.25</td>
    </tr>
    <tr>
      <th>Avg. winning trade</th>
      <td>$155.51</td>
      <td>$34.64</td>
      <td>$186.90</td>
    </tr>
    <tr>
      <th>Avg. losing trade</th>
      <td>$-131.44</td>
      <td>$-30.83</td>
      <td>$-154.97</td>
    </tr>
    <tr>
      <th>Ratio Avg. Win:Avg. Loss</th>
      <td>$1.18</td>
      <td>$1.12</td>
      <td>$1.21</td>
    </tr>
    <tr>
      <th>Largest winning trade</th>
      <td>$9500.14</td>
      <td>$1623.24</td>
      <td>$9500.14</td>
    </tr>
    <tr>
      <th>Largest losing trade</th>
      <td>$-22902.83</td>
      <td>$-661.29</td>
      <td>$-22902.83</td>
    </tr>
  </tbody>
</table></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Duration stats</th>
      <th>All trades</th>
      <th>Short trades</th>
      <th>Long trades</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Avg duration</th>
      <td>13 days 03:21:49.653555479</td>
      <td>2 days 10:39:35.064935064</td>
      <td>15 days 18:53:36.628026569</td>
    </tr>
    <tr>
      <th>Median duration</th>
      <td>8 days 00:00:00</td>
      <td>2 days 00:00:00</td>
      <td>12 days 00:00:00</td>
    </tr>
    <tr>
      <th>Longest duration</th>
      <td>84 days 00:00:00</td>
      <td>13 days 00:00:00</td>
      <td>84 days 00:00:00</td>
    </tr>
    <tr>
      <th>Shortest duration</th>
      <td>0 days 00:00:01</td>
      <td>1 days 00:00:00</td>
      <td>0 days 00:00:01</td>
    </tr>
  </tbody>
</table></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Return stats</th>
      <th>All trades</th>
      <th>Short trades</th>
      <th>Long trades</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Avg returns all round_trips</th>
      <td>0.01%</td>
      <td>0.01%</td>
      <td>0.01%</td>
    </tr>
    <tr>
      <th>Avg returns winning</th>
      <td>0.13%</td>
      <td>0.13%</td>
      <td>0.12%</td>
    </tr>
    <tr>
      <th>Avg returns losing</th>
      <td>-0.11%</td>
      <td>-0.12%</td>
      <td>-0.11%</td>
    </tr>
    <tr>
      <th>Median returns all round_trips</th>
      <td>-0.00%</td>
      <td>0.00%</td>
      <td>-0.00%</td>
    </tr>
    <tr>
      <th>Median returns winning</th>
      <td>0.02%</td>
      <td>0.02%</td>
      <td>0.02%</td>
    </tr>
    <tr>
      <th>Median returns losing</th>
      <td>-0.01%</td>
      <td>-0.01%</td>
      <td>-0.01%</td>
    </tr>
    <tr>
      <th>Largest winning trade</th>
      <td>6.78%</td>
      <td>6.78%</td>
      <td>6.19%</td>
    </tr>
    <tr>
      <th>Largest losing trade</th>
      <td>-17.23%</td>
      <td>-3.95%</td>
      <td>-17.23%</td>
    </tr>
  </tbody>
</table></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Symbol stats</th>
      <th>AMD</th>
      <th>CERN</th>
      <th>COST</th>
      <th>DELL</th>
      <th>GPS</th>
      <th>INTC</th>
      <th>MMM</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Avg returns all round_trips</th>
      <td>0.04%</td>
      <td>-0.01%</td>
      <td>-0.02%</td>
      <td>0.02%</td>
      <td>-0.02%</td>
      <td>-0.04%</td>
      <td>0.07%</td>
    </tr>
    <tr>
      <th>Avg returns winning</th>
      <td>0.13%</td>
      <td>0.08%</td>
      <td>0.09%</td>
      <td>0.12%</td>
      <td>0.12%</td>
      <td>0.17%</td>
      <td>0.16%</td>
    </tr>
    <tr>
      <th>Avg returns losing</th>
      <td>-0.07%</td>
      <td>-0.08%</td>
      <td>-0.10%</td>
      <td>-0.08%</td>
      <td>-0.18%</td>
      <td>-0.21%</td>
      <td>-0.05%</td>
    </tr>
    <tr>
      <th>Median returns all round_trips</th>
      <td>0.00%</td>
      <td>-0.00%</td>
      <td>-0.00%</td>
      <td>0.00%</td>
      <td>0.00%</td>
      <td>-0.00%</td>
      <td>0.00%</td>
    </tr>
    <tr>
      <th>Median returns winning</th>
      <td>0.02%</td>
      <td>0.02%</td>
      <td>0.02%</td>
      <td>0.02%</td>
      <td>0.02%</td>
      <td>0.02%</td>
      <td>0.03%</td>
    </tr>
    <tr>
      <th>Median returns losing</th>
      <td>-0.01%</td>
      <td>-0.01%</td>
      <td>-0.01%</td>
      <td>-0.01%</td>
      <td>-0.02%</td>
      <td>-0.03%</td>
      <td>-0.01%</td>
    </tr>
    <tr>
      <th>Largest winning trade</th>
      <td>6.78%</td>
      <td>1.69%</td>
      <td>1.48%</td>
      <td>3.29%</td>
      <td>2.72%</td>
      <td>5.01%</td>
      <td>6.14%</td>
    </tr>
    <tr>
      <th>Largest losing trade</th>
      <td>-1.59%</td>
      <td>-6.39%</td>
      <td>-4.48%</td>
      <td>-3.28%</td>
      <td>-17.23%</td>
      <td>-6.86%</td>
      <td>-1.60%</td>
    </tr>
  </tbody>
</table></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Profitability (PnL / PnL total) per name</th>
      <th></th>
    </tr>
    <tr>
      <th>symbol</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>COST</th>
      <td>39.90%</td>
    </tr>
    <tr>
      <th>INTC</th>
      <td>38.27%</td>
    </tr>
    <tr>
      <th>CERN</th>
      <td>32.31%</td>
    </tr>
    <tr>
      <th>MMM</th>
      <td>22.15%</td>
    </tr>
    <tr>
      <th>GPS</th>
      <td>4.94%</td>
    </tr>
    <tr>
      <th>AMD</th>
      <td>-6.41%</td>
    </tr>
    <tr>
      <th>DELL</th>
      <td>-31.15%</td>
    </tr>
  </tbody>
</table></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Profitability (PnL / PnL total) per name</th>
      <th></th>
    </tr>
    <tr>
      <th>symbol</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Consumer Goods</th>
      <td>39.90%</td>
    </tr>
    <tr>
      <th>Healthcare</th>
      <td>32.31%</td>
    </tr>
    <tr>
      <th>Construction</th>
      <td>22.15%</td>
    </tr>
    <tr>
      <th>Technology</th>
      <td>5.65%</td>
    </tr>
  </tbody>
</table></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_round_trip_tear_sheet_example_11_7.png" src="../_images/notebooks_round_trip_tear_sheet_example_11_7.png" />
</div>
</div>
</div>
<div class="section" id="Explore-underlying-functions">
<h2>Explore underlying functions<a class="headerlink" href="#Explore-underlying-functions" title="Permalink to this headline">¶</a></h2>
<p>Under the hood, several functions are being called. <code class="docutils literal notranslate"><span class="pre">extract_round_trips()</span></code> does the portfolio reconstruction and creates the round-trip trades.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rts</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">round_trips</span><span class="o">.</span><span class="n">extract_round_trips</span><span class="p">(</span><span class="n">transactions</span><span class="p">,</span>
                                         <span class="n">portfolio_value</span><span class="o">=</span><span class="n">positions</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">returns</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rts</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pnl</th>
      <th>open_dt</th>
      <th>close_dt</th>
      <th>long</th>
      <th>rt_returns</th>
      <th>symbol</th>
      <th>duration</th>
      <th>returns</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-126.000000</td>
      <td>2004-01-09 00:00:00+00:00</td>
      <td>2004-01-13 00:00:00+00:00</td>
      <td>True</td>
      <td>-0.022523</td>
      <td>AMD</td>
      <td>4 days</td>
      <td>0.000793</td>
    </tr>
    <tr>
      <th>1</th>
      <td>50.020000</td>
      <td>2004-01-09 00:00:00+00:00</td>
      <td>2004-01-16 00:00:00+00:00</td>
      <td>True</td>
      <td>0.078507</td>
      <td>AMD</td>
      <td>7 days</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1540.099065</td>
      <td>2004-01-09 00:00:00+00:00</td>
      <td>2004-01-20 00:00:00+00:00</td>
      <td>True</td>
      <td>0.104696</td>
      <td>AMD</td>
      <td>11 days</td>
      <td>0.000184</td>
    </tr>
    <tr>
      <th>3</th>
      <td>287.119806</td>
      <td>2004-01-20 00:00:00+00:00</td>
      <td>2004-01-21 00:00:00+00:00</td>
      <td>False</td>
      <td>0.085155</td>
      <td>AMD</td>
      <td>1 days</td>
      <td>0.000984</td>
    </tr>
    <tr>
      <th>4</th>
      <td>103.349947</td>
      <td>2004-01-20 00:00:00+00:00</td>
      <td>2004-01-22 00:00:00+00:00</td>
      <td>False</td>
      <td>0.112198</td>
      <td>AMD</td>
      <td>2 days</td>
      <td>-0.001249</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pf</span><span class="o">.</span><span class="n">round_trips</span><span class="o">.</span><span class="n">print_round_trip_stats</span><span class="p">(</span><span class="n">rts</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Summary stats</th>
      <th>All trades</th>
      <th>Short trades</th>
      <th>Long trades</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Total number of round_trips</th>
      <td>5819.00</td>
      <td>1155.00</td>
      <td>4664.00</td>
    </tr>
    <tr>
      <th>Percent profitable</th>
      <td>0.50</td>
      <td>0.52</td>
      <td>0.49</td>
    </tr>
    <tr>
      <th>Winning round_trips</th>
      <td>2887.00</td>
      <td>595.00</td>
      <td>2292.00</td>
    </tr>
    <tr>
      <th>Losing round_trips</th>
      <td>2914.00</td>
      <td>553.00</td>
      <td>2361.00</td>
    </tr>
    <tr>
      <th>Even round_trips</th>
      <td>18.00</td>
      <td>7.00</td>
      <td>11.00</td>
    </tr>
  </tbody>
</table></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>PnL stats</th>
      <th>All trades</th>
      <th>Short trades</th>
      <th>Long trades</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Total profit</th>
      <td>$67003.94</td>
      <td>$3531.32</td>
      <td>$63472.61</td>
    </tr>
    <tr>
      <th>Gross profit</th>
      <td>$448674.42</td>
      <td>$20579.67</td>
      <td>$428094.75</td>
    </tr>
    <tr>
      <th>Gross loss</th>
      <td>$-381670.48</td>
      <td>$-17048.35</td>
      <td>$-364622.13</td>
    </tr>
    <tr>
      <th>Profit factor</th>
      <td>$1.18</td>
      <td>$1.21</td>
      <td>$1.17</td>
    </tr>
    <tr>
      <th>Avg. trade net profit</th>
      <td>$11.51</td>
      <td>$3.06</td>
      <td>$13.61</td>
    </tr>
    <tr>
      <th>Avg. winning trade</th>
      <td>$155.41</td>
      <td>$34.59</td>
      <td>$186.78</td>
    </tr>
    <tr>
      <th>Avg. losing trade</th>
      <td>$-130.98</td>
      <td>$-30.83</td>
      <td>$-154.44</td>
    </tr>
    <tr>
      <th>Ratio Avg. Win:Avg. Loss</th>
      <td>$1.19</td>
      <td>$1.12</td>
      <td>$1.21</td>
    </tr>
    <tr>
      <th>Largest winning trade</th>
      <td>$9500.14</td>
      <td>$1623.24</td>
      <td>$9500.14</td>
    </tr>
    <tr>
      <th>Largest losing trade</th>
      <td>$-22902.83</td>
      <td>$-661.29</td>
      <td>$-22902.83</td>
    </tr>
  </tbody>
</table></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Duration stats</th>
      <th>All trades</th>
      <th>Short trades</th>
      <th>Long trades</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Avg duration</th>
      <td>13 days 03:27:07.702354356</td>
      <td>2 days 10:39:35.064935064</td>
      <td>15 days 19:02:40.548885077</td>
    </tr>
    <tr>
      <th>Median duration</th>
      <td>8 days 00:00:00</td>
      <td>2 days 00:00:00</td>
      <td>12 days 00:00:00</td>
    </tr>
    <tr>
      <th>Longest duration</th>
      <td>84 days 00:00:00</td>
      <td>13 days 00:00:00</td>
      <td>84 days 00:00:00</td>
    </tr>
    <tr>
      <th>Shortest duration</th>
      <td>1 days 00:00:00</td>
      <td>1 days 00:00:00</td>
      <td>1 days 00:00:00</td>
    </tr>
  </tbody>
</table></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Return stats</th>
      <th>All trades</th>
      <th>Short trades</th>
      <th>Long trades</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Avg returns all round_trips</th>
      <td>0.01%</td>
      <td>-0.00%</td>
      <td>0.01%</td>
    </tr>
    <tr>
      <th>Avg returns winning</th>
      <td>0.13%</td>
      <td>0.12%</td>
      <td>0.13%</td>
    </tr>
    <tr>
      <th>Avg returns losing</th>
      <td>-0.11%</td>
      <td>-0.11%</td>
      <td>-0.11%</td>
    </tr>
    <tr>
      <th>Median returns all round_trips</th>
      <td>-0.00%</td>
      <td>-0.00%</td>
      <td>0.00%</td>
    </tr>
    <tr>
      <th>Median returns winning</th>
      <td>0.02%</td>
      <td>0.02%</td>
      <td>0.02%</td>
    </tr>
    <tr>
      <th>Median returns losing</th>
      <td>-0.01%</td>
      <td>-0.02%</td>
      <td>-0.01%</td>
    </tr>
    <tr>
      <th>Largest winning trade</th>
      <td>6.78%</td>
      <td>6.78%</td>
      <td>6.19%</td>
    </tr>
    <tr>
      <th>Largest losing trade</th>
      <td>-17.23%</td>
      <td>-3.92%</td>
      <td>-17.23%</td>
    </tr>
  </tbody>
</table></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Symbol stats</th>
      <th>AMD</th>
      <th>CERN</th>
      <th>COST</th>
      <th>DELL</th>
      <th>GPS</th>
      <th>INTC</th>
      <th>MMM</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Avg returns all round_trips</th>
      <td>0.04%</td>
      <td>-0.01%</td>
      <td>-0.02%</td>
      <td>0.02%</td>
      <td>-0.02%</td>
      <td>-0.04%</td>
      <td>0.08%</td>
    </tr>
    <tr>
      <th>Avg returns winning</th>
      <td>0.13%</td>
      <td>0.08%</td>
      <td>0.09%</td>
      <td>0.12%</td>
      <td>0.12%</td>
      <td>0.17%</td>
      <td>0.16%</td>
    </tr>
    <tr>
      <th>Avg returns losing</th>
      <td>-0.07%</td>
      <td>-0.08%</td>
      <td>-0.10%</td>
      <td>-0.08%</td>
      <td>-0.18%</td>
      <td>-0.21%</td>
      <td>-0.05%</td>
    </tr>
    <tr>
      <th>Median returns all round_trips</th>
      <td>0.00%</td>
      <td>-0.00%</td>
      <td>-0.00%</td>
      <td>0.00%</td>
      <td>0.00%</td>
      <td>-0.00%</td>
      <td>0.00%</td>
    </tr>
    <tr>
      <th>Median returns winning</th>
      <td>0.02%</td>
      <td>0.01%</td>
      <td>0.01%</td>
      <td>0.02%</td>
      <td>0.02%</td>
      <td>0.02%</td>
      <td>0.03%</td>
    </tr>
    <tr>
      <th>Median returns losing</th>
      <td>-0.01%</td>
      <td>-0.01%</td>
      <td>-0.01%</td>
      <td>-0.01%</td>
      <td>-0.02%</td>
      <td>-0.03%</td>
      <td>-0.01%</td>
    </tr>
    <tr>
      <th>Largest winning trade</th>
      <td>6.78%</td>
      <td>1.69%</td>
      <td>1.48%</td>
      <td>3.29%</td>
      <td>2.72%</td>
      <td>5.01%</td>
      <td>6.14%</td>
    </tr>
    <tr>
      <th>Largest losing trade</th>
      <td>-1.59%</td>
      <td>-6.39%</td>
      <td>-4.48%</td>
      <td>-3.28%</td>
      <td>-17.23%</td>
      <td>-6.86%</td>
      <td>-1.60%</td>
    </tr>
  </tbody>
</table></div>
</div>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="zipline_algo_example.html" title="previous page">Zipline Algorithm</a>
    <a class='right-next' id="next-link" href="sector_mappings_example.html" title="next page">Sector Analysis</a>

              </div>
              
          </main>
          

      </div>
    </div>
    
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>


    
    <!-- Google Analytics -->
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-74956955-3', 'auto');
      ga('set', 'anonymizeIp', true);
      ga('send', 'pageview');
    </script>
    <script async src='https://www.google-analytics.com/analytics.js'></script>
    <!-- End Google Analytics -->
    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2016, Quantopian, Inc..<br/>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.5.4.<br/>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>